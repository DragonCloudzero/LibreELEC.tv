From 251311830726da9bd68c6f361233e72029e734c4 Mon Sep 17 00:00:00 2001
From: Jonas Karlman <jonas@kwiboo.se>
Date: Sat, 21 Apr 2018 12:52:58 +0200
Subject: [PATCH] drm/rockchip: skip 4K 50/60Hz clocks for RK3328

---
 drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
index 6e014484b828..94c690276857 100644
--- a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
@@ -517,6 +517,10 @@ dw_hdmi_rockchip_mode_valid(struct drm_connector *connector,
 	if (hdmi->dev_type == RK3288_HDMI && (mode->clock < 27500 || mode->clock > 340000))
 		return MODE_CLOCK_RANGE;
 
+	/* Skip 4K 50/60Hz clocks for RK3328 */
+	if (hdmi->dev_type == RK3328_HDMI && mode->clock > 340000)
+		return MODE_CLOCK_RANGE;
+
 	/*
 	 * ensure all drm display mode can work, if someone want support more
 	 * resolutions, please limit the possible_crtc, only connect to

From 5cf3b4c5e3d57bfe79da13d258217d6b0f5ac11e Mon Sep 17 00:00:00 2001
From: Jonas Karlman <jonas@kwiboo.se>
Date: Sat, 21 Apr 2018 12:53:04 +0200
Subject: [PATCH] drm/rockchip: skip 4K 50/60Hz clocks for RK3399

---
 drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
index 94c690276857..3266b7ce899f 100644
--- a/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
+++ b/drivers/gpu/drm/rockchip/dw_hdmi-rockchip.c
@@ -521,6 +521,10 @@ dw_hdmi_rockchip_mode_valid(struct drm_connector *connector,
 	if (hdmi->dev_type == RK3328_HDMI && mode->clock > 340000)
 		return MODE_CLOCK_RANGE;
 
+	/* Skip 4K 50/60Hz clocks for RK3399 */
+	if (hdmi->dev_type == RK3399_HDMI && mode->clock > 340000)
+		return MODE_CLOCK_RANGE;
+
 	/*
 	 * ensure all drm display mode can work, if someone want support more
 	 * resolutions, please limit the possible_crtc, only connect to
